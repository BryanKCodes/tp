@startuml
!include style.puml
skinparam ArrowFontStyle plain

mainframe **sd** Scenario: Forms At Least One Team

box Logic LOGIC_COLOR_T1
participant "g:GroupCommand" as GroupCommand LOGIC_COLOR
participant ":TeamMatcher" as TeamMatcher LOGIC_COLOR
end box

activate GroupCommand

GroupCommand -> TeamMatcher : matchTeams(unassignedPersons)
activate TeamMatcher

TeamMatcher -> TeamMatcher : groupPersonsByRole()
TeamMatcher -> TeamMatcher : createSortedCopy()
TeamMatcher -> TeamMatcher : validateMinimumPersons()

loop while canFormTeam()
    loop for each required role
        TeamMatcher -> TeamMatcher : selectPersonWithoutChampionConflict(...)

        opt person found without conflict
            TeamMatcher -> TeamMatcher : addPersonToCurrentTeam(person)
        end

        break no person available
            note right
                A conflict occurred or pool was empty.
                Stopping formation of this team.
            end note
        end
    end

    opt current team is full (5 persons)
        TeamMatcher -> TeamMatcher : createTeam(currentTeam)
        TeamMatcher -> TeamMatcher : addToTeamsList(team)
    end
end

TeamMatcher --> GroupCommand : teams
deactivate TeamMatcher

@enduml
